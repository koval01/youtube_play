let notify_hidden,timer_notify,video_id_link,video_loading=!1;
const backend_host="https://app-e2kzupurruxt8bx4oroby8gnga.herokuapp.com",update_video_id_link=()=>{let a=window.location.hash.slice(1);video_id_link!==a&&a.length?(video_id_link=a,update_video()):a.length||notify("Video ID not specified")},numberWithCommas=a=>a.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,","),getRandomInt=(a,b)=>{a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a)+a)},repeatStringNumTimes=(a,b)=>{for(var c="";0<b;)c+=a,b--;return c},request_call=(a,b,c,
e=!1,f=null)=>{let d=new XMLHttpRequest,g={};d.open(c,b,!0);"POST"===c.toUpperCase()&&(d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),g=JSON.stringify(f));d.onload=function(){200<=d.status&&400>d.status?e?a(JSON.parse(d.responseText)):a(d.responseText):console.log(`Request status code is ${d.status}`)};d.onerror=function(h){console.log(`Error make request! Details: ${h}`);a(null)};d.onreadystatechange=()=>{400<=d.status&&(e?a({success:!1}):a(null))};d.send(g)},get_video=(a,b)=>
{request_call(function(c){c?c.success?a(c.body):(notify("Server-side function error"),error_load_video()):(notify("Application server error"),error_load_video())},`${backend_host}/get_video`,"POST",!0,{video_id:b})},update_video_observer=()=>{let a=document.querySelector("video");a.onpause=b=>{play_control(b)};a.onplay=b=>{video_loading=!1;play_control(b)};a.onwaiting=b=>{video_loading=!0;play_control({type:"pause"})};a.onplaying=b=>{video_loading=!1;play_control({type:"play"})}},update_video=()=>
{let a=document.getElementById("video-container");notify("Please wait, receiving data...");get_video(function(b){var c=new Date(1E3*b.epoch),e=b.formats.audio.url,f=b.formats.video.q480p.url,d=b.title,g=numberWithCommas(b.view_count),h=c.toLocaleString("default",{month:"short"}).slice(0,-1),l=c.getDay();c=c.getFullYear();var m=numberWithCommas(b.like_count),n=b.description.replaceAll("\n","<br/>");b=b.tags;let k="";if(b)for(let p of b)k+=`#${p}\x20`;a.innerHTML=`
            <audio style="visibility: hidden;position: fixed;z-index: -1">
                <source src="${e}" type="audio/mpeg">
            </audio>
            <video controls>
                <source id="video-source" src="${f}" type="video/mp4">
            </video>
            <div class="video-meta">
                <h1>${d}</h1>
                <div class="info-box">
                    <p class="views">${g} views</p>
                    <span class="dot"></span>
                    <p>${h} ${l}, ${c}</p>
                    <div class="stat-block">
                        <div class="thumb-up"></div>
                        <p>${m}</p>
                    </div>
                </div>
                <p>${n}</p>
                <br/>
                <span class="video-tags">${k}</span>
            </div>
        `;update_video_observer()},video_id_link)},notify=a=>{let b=document.querySelector(".error_box_cst"),c=document.querySelector(".error_text_cst"),e=function(){b.style.marginBottom="-150px";notify_hidden=!0},f=function(){notify_hidden=!1;c.innerHTML=a;b.style.marginBottom="0"};notify_hidden?f():(e(),setTimeout(f,200));clearTimeout(timer_notify);timer_notify=setTimeout(e,2500)},is_attention_splash=()=>{Cookies.get("attention_close")||(document.querySelector(".is-attention-splash").style.display=
"")},close_attention_splash=()=>{let a=document.querySelector(".is-attention-splash");a.style.marginTop="-100vh";setTimeout(function(){a.style.display="none"},600);Cookies.set("attention_close","1")},generate_pseudo_line=(a,b=[5,20])=>{let c="";for(let e=0;e<a;e++)c+=repeatStringNumTimes("-",getRandomInt(b[0],b[1]))+" ";return c},error_load_video=()=>{document.getElementById("video-container").innerHTML=`
        <div class="pseudo-video"></div>
        <div class="video-meta flow-lines">
            <h1>${generate_pseudo_line(6)}</h1>
            <div class="info-box">
                <p class="views">--------- ------</p>
                <span class="dot"></span>
                <p>------- ----</p>
                <div class="stat-block">
                    <p>--------</p>
                </div>
            </div>
            <p>${generate_pseudo_line(40)}</p>
            <br/>
            <span class="video-tags">${generate_pseudo_line(getRandomInt(5,20),[3,10])}</span>
        </div>
    `},sync_time=()=>{let a=document.querySelector("video"),b=document.querySelector("audio");video_loading||(b.currentTime=a.currentTime)},play_control=a=>{let b=document.querySelector("audio");"play"===a.type?(sync_time(),b.play().then(c=>{})):"pause"===a.type&&b.pause()},loading_finish=()=>{let a=document.querySelector(".page-loading");setTimeout(function(){a.classList.remove("active")},500);setTimeout(function(){a.remove()},600)};
window.onload=function(){loading_finish();is_attention_splash();error_load_video();update_video_id_link();window.onhashchange=a=>{update_video_id_link()}};
