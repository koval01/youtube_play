let notify_hidden,timer_notify,video_id_link,video_loading=!1,audio_stream=!0;
const backend_host="https://app-e2kzupurruxt8bx4oroby8gnga.herokuapp.com",updateVideoIdLink=()=>{let a=window.location.hash.slice(1);video_id_link!==a&&a.length?(video_id_link=a,updateVideo()):a.length||notify("Video ID not specified")},linkify=a=>{a=a.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>');a=a.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>');return a=a.replace(/(([a-zA-Z0-9\-_\.])+@[a-zA-Z_]+?(\.[a-zA-Z]{2,6})+)/gim,
'<a href="mailto:$1">$1</a>')},numberWithCommas=a=>a.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,","),getRandomInt=(a,b)=>{a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a)+a)},repeatStringNumTimes=(a,b)=>{for(var c="";0<b;)c+=a,b--;return c},requestCall=(a,b,c,e=!1,f=null)=>{let d=new XMLHttpRequest,g={};d.open(c,b,!0);"POST"===c.toUpperCase()&&(d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),g=JSON.stringify(f));d.onload=function(){200<=d.status&&
400>d.status?e?a(JSON.parse(d.responseText)):a(d.responseText):console.log(`Request status code is ${d.status}`)};d.onerror=function(h){console.log(`Error make request! Details: ${h}`);a(null)};d.onreadystatechange=()=>{400<=d.status&&(e?a({success:!1}):a(null))};d.send(g)},getVideo=(a,b)=>{requestCall(function(c){c?c.success?a(c.body):(notify("Server-side function error"),errorLoadVideo()):(notify("Application server error"),errorLoadVideo())},`${backend_host}/getVideo`,"POST",!0,{video_id:b})},
updateVideoObserver=()=>{let a=document.querySelector("video");a.onpause=b=>{playControl(b)};a.onplay=b=>{video_loading=!1;playControl(b)};a.onwaiting=b=>{video_loading=!0;playControl({type:"pause"})};a.onplaying=b=>{video_loading=!1;playControl({type:"play"})}},updateVideo=()=>{let a=document.getElementById("video-container");notify("Please wait, receiving data...");getVideo(function(b){var c=b.formats.video,e=c[Object.keys(c)[Object.keys(c).length-1]];audio_stream="none"===e.acodec;var f="";b.release_timestamp&&
(c=new Date(1E3*b.release_timestamp),f=`
                <span class="dot"></span>
                <p>${c.toLocaleString("default",{month:"short"}).slice(0,3)} ${c.toLocaleString("default",{day:"numeric"})}, ${c.getFullYear()}</p>
            `);c=b.formats.audio.url;e=e.url;var d=b.title,g=numberWithCommas(b.view_count),h=b.like_count?numberWithCommas(b.like_count):"",l=linkify(b.description.replaceAll("\n","<br/>"));b=b.tags;let k="";if(b)for(let m of b)k+=`#${m}\x20`;a.innerHTML=`
            <audio style="visibility: hidden;position: fixed;z-index: -1">
                <source src="${c}" type="audio/mpeg">
            </audio>
            <video controls>
                <source id="video-source" src="${e}" type="video/mp4">
            </video>
            <div class="video-meta">
                <h1>${d}</h1>
                <div class="info-box">
                    <p class="views">${g} views</p>
                    ${f}
                    <div class="stat-block">
                        <div class="thumb-up"></div>
                        <p>${h}</p>
                    </div>
                </div>
                <p>${l}</p>
                <br/>
                <span class="video-tags">${k}</span>
            </div>
        `;updateVideoObserver()},video_id_link)},notify=a=>{let b=document.querySelector(".error_box_cst"),c=document.querySelector(".error_text_cst"),e=function(){b.style.marginBottom="-150px";notify_hidden=!0},f=function(){notify_hidden=!1;c.innerHTML=a;b.style.marginBottom="0"};notify_hidden?f():(e(),setTimeout(f,200));clearTimeout(timer_notify);timer_notify=setTimeout(e,2500)},isAttentionSplash=()=>{Cookies.get("attention_close")||(document.querySelector(".is-attention-splash").style.display=
"")},closeAttentionSplash=()=>{let a=document.querySelector(".is-attention-splash");a.style.marginTop="-100vh";setTimeout(function(){a.style.display="none"},600);Cookies.set("attention_close","1")},generatePseudoLine=(a,b=[5,20])=>{let c="";for(let e=0;e<a;e++)c+=repeatStringNumTimes("-",getRandomInt(b[0],b[1]))+" ";return c},errorLoadVideo=()=>{document.getElementById("video-container").innerHTML=`
        <div class="pseudo-video"></div>
        <div class="video-meta flow-lines">
            <h1>${generatePseudoLine(6)}</h1>
            <div class="info-box">
                <p class="views">--------- ------</p>
                <span class="dot"></span>
                <p>------- ----</p>
                <div class="stat-block">
                    <p>--------</p>
                </div>
            </div>
            <p>${generatePseudoLine(40)}</p>
            <br/>
            <span class="video-tags">${generatePseudoLine(getRandomInt(5,20),[3,10])}</span>
        </div>
    `},syncTime=()=>{let a=document.querySelector("video"),b=document.querySelector("audio");video_loading||(b.currentTime=a.currentTime)},playControl=a=>{let b=document.querySelector("audio");"play"===a.type?(syncTime(),audio_stream?b.play().then(c=>{}):b.pause()):"pause"===a.type&&b.pause()},loadingFinish=()=>{let a=document.querySelector(".page-loading");setTimeout(function(){a.classList.remove("active")},500);setTimeout(function(){a.remove()},600)};
window.onload=function(){loadingFinish();isAttentionSplash();errorLoadVideo();updateVideoIdLink();window.onhashchange=a=>{updateVideoIdLink()}};
